{# templates/qbank/course_master_form.html #}
{% extends "inc/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% if form.instance.pk %}Dersi Güncelle{% else %}Yeni Ders{% endif %}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">{% if form.instance.pk %}{% trans "Dersi Güncelle" %}{% else %}{% trans "Yeni Ders" %}{% endif %}</h2>
    <a class="btn btn-secondary" href="{% url 'qbank:course_master_list' %}">Listeye Dön</a>
  </div>

  {% if form.non_field_errors %}
    <div class="alert alert-danger">{{ form.non_field_errors }}</div>
  {% endif %}

  <div class="card shadow-sm">
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label">{% trans "Ad" %}</label>
            {{ form.name }}
            {% if form.name.errors %}<div class="text-danger small">{{ form.name.errors }}</div>{% endif %}
          </div>
          <div class="col-md-4">
            <label class="form-label">{% trans "Tür" %}</label>
            {{ form.type }}
            {% if form.type.errors %}<div class="text-danger small">{{ form.type.errors }}</div>{% endif %}
          </div>

          <div class="col-md-4">
            <label class="form-label">{% trans "Öğretim Üyesi" %}</label>
            {{ form.lecturer }}
            {% if form.lecturer.errors %}<div class="text-danger small">{{ form.lecturer.errors }}</div>{% endif %}
          </div>
          <div class="col-md-4">
            <label class="form-label">{% trans "Kurul/Staj" %}</label>
            {{ form.committee }}
            {% if form.committee.errors %}<div class="text-danger small">{{ form.committee.errors }}</div>{% endif %}
          </div>
          <div class="col-md-4">
            <label class="form-label">{% trans "Bölüm (otomatik)" %}</label>
            {{ form.department }}         {# gizli FK #}
            {{ form.department_display }} {# salt-okunur #}
          </div>

          <div class="col-md-4">
            <label class="form-label">{% trans "Etkinlik Sayısı" %}</label>
            {{ form.event_count }}
            {% if form.event_count.errors %}<div class="text-danger small">{{ form.event_count.errors }}</div>{% endif %}
          </div>

          <div class="col-md-4">
            <div class="form-check form-switch mt-4">
              {{ form.multilecture }}
              <label class="form-check-label">{% trans "Çok öğretim üyesi" %}</label>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-check form-switch mt-4">
              {{ form.active }}
              <label class="form-check-label">{% trans "Aktif" %}</label>
            </div>
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-primary" type="submit">{% trans "Kaydet" %}</button>
          <a class="btn btn-outline-secondary" href="{% url 'qbank:course_master_list' %}">{% trans "Vazgeç" %}</a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Select2 CSS/JS (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>

<script>
  (function() {
    function widthResolver(el) { return '100%'; }
    $('.select2').select2({
      theme: 'bootstrap-5',
      width: $(this).data('width') ? $(this).data('width') : widthResolver(this),
      placeholder: function(){ return $(this).data('placeholder') || 'Seçiniz'; },
      allowClear: true
    });
  })();
</script>
{% endblock %}


