{% extends "inc/base.html" %}
{% load static %}

{% block title %}{% if form.instance.pk %}Sınavı Düzenle{% else %}Yeni Sınav{% endif %}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">{% if form.instance.pk %}Sınavı Düzenle{% else %}Yeni Sınav{% endif %}</h2>
    <a class="btn btn-secondary" href="{% url 'qbank:examsetup_list' %}">Listeye Dön</a>
  </div>

  {% if form.errors %}
    <div class="alert alert-danger">
      <strong>Formda hatalar var.</strong>
      <ul class="mb-0">
        {% for field in form %}
          {% for err in field.errors %}
            <li><strong>{{ field.label }}:</strong> {{ err }}</li>
          {% endfor %}
        {% endfor %}
        {% for err in form.non_field_errors %}
          <li>{{ err }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}
    <div class="card shadow-sm mb-3">
      <div class="card-body row g-3">
        <div class="col-md-6">
          <label class="form-label">Ad</label>
          {{ form.name }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Tür</label>
          {{ form.type }}
        </div>
        <div class="col-md-3">
          <label class="form-label d-block">Ceza Uygula</label>
          {{ form.apply_penalty }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Program</label>
          {{ form.program }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Kurul/Staj</label>
          {{ form.committee }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Tarih</label>
          {{ form.date }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Başlangıç</label>
          {{ form.start }}
          <div class="form-text">yyyy-aa-gg ss:dd (yerel saat)</div>
        </div>
        <div class="col-md-3">
          <label class="form-label">Bitiş</label>
          {{ form.finish }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Soru Sayısı</label>
          {{ form.qtotal }}
        </div>
        <div class="col-md-3">
          <label class="form-label d-block">Kilitli</label>
          {{ form.locked }}
        </div>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">Kaydet</button>
      <a href="{% url 'qbank:examsetup_list' %}" class="btn btn-outline-secondary">Vazgeç</a>
    </div>
  </form>
</div>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>
<script>
(function(){
  function widthResolver(){ return '100%'; }
  $('.select2').select2({
    theme: 'bootstrap-5',
    width: widthResolver(),
    allowClear: true,
    placeholder: function(){ return $(this).data('placeholder') || 'Seçiniz'; }
  });
})();
</script>
{% endblock %}
